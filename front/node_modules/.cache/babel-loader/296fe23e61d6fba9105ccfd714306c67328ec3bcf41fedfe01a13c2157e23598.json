{"ast":null,"code":"import { login, userInfo, initCaptcha, drawCodeImage } from \"@/api/index\";\nimport Cookies from \"js-cookie\";\nimport util from \"@/libs/util.js\";\nexport default {\n  components: {},\n  data() {\n    return {\n      saoMaFx: false,\n      captchaId: \"\",\n      captchaImg: \"\",\n      loadingCaptcha: false,\n      error: false,\n      tabName: \"userAndPassword\",\n      saveLogin: true,\n      loading: false,\n      form: {\n        username: \"admin\",\n        password: \"123456\",\n        mobile: \"\",\n        code: \"\"\n      },\n      usernameLoginFormRules: {\n        username: [{\n          required: true,\n          message: \"账号不能为空\",\n          trigger: \"blur\"\n        }],\n        password: [{\n          required: true,\n          message: \"密码不能为空\",\n          trigger: \"blur\"\n        }],\n        imgCode: [{\n          required: true,\n          message: \"验证码不能为空\",\n          trigger: \"blur\"\n        }]\n      }\n    };\n  },\n  methods: {\n    getCaptchaImg() {\n      this.loadingCaptcha = true;\n      initCaptcha().then(res => {\n        this.loadingCaptcha = false;\n        if (res.success) {\n          this.captchaId = res.result;\n          this.captchaImg = drawCodeImage + this.captchaId;\n        }\n      });\n    },\n    changeTabName(e) {\n      if (e != \"userAndPassword\") {\n        window.WwLogin({\n          \"id\": \"qywxsmqywxsm\",\n          \"appid\": \"wwf94bb44e76e308f8\",\n          \"agentid\": \"1000002\",\n          \"redirect_uri\": \"https://artskyhome.com:8080/%23/login\",\n          \"state\": \"ZWZ1314520\",\n          \"href\": \"\"\n        });\n      }\n    },\n    afterLogin(res) {\n      let accessToken = res.result;\n      this.setStore(\"accessToken\", accessToken);\n      userInfo().then(res => {\n        if (res.success) {\n          delete res.result.permissions;\n          let roles = [];\n          res.result.roles.forEach(e => {\n            roles.push(e.name);\n          });\n          delete res.result.roles;\n          this.setStore(\"roles\", roles);\n          this.setStore(\"saveLogin\", this.saveLogin);\n          if (this.saveLogin) {\n            Cookies.set(\"userInfo\", JSON.stringify(res.result), {\n              expires: 7\n            });\n          } else {\n            Cookies.set(\"userInfo\", JSON.stringify(res.result));\n          }\n          this.setStore(\"userInfo\", res.result);\n          this.$store.commit(\"setAvatarPath\", res.result.avatar);\n          util.initRouter(this);\n          this.$router.push({\n            name: \"home_index\"\n          });\n        } else {\n          this.loading = false;\n        }\n      });\n    },\n    submitLogin() {\n      this.$refs.usernameLoginForm.validate(valid => {\n        if (valid) {\n          this.loading = true;\n          login({\n            username: this.form.username,\n            password: this.form.password,\n            code: this.form.imgCode,\n            captchaId: this.captchaId,\n            saveLogin: this.saveLogin\n          }).then(res => {\n            if (res.success) {\n              this.afterLogin(res);\n            } else {\n              this.loading = false;\n              this.getCaptchaImg();\n            }\n          });\n        }\n      });\n    }\n  },\n  mounted() {\n    this.getCaptchaImg();\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}