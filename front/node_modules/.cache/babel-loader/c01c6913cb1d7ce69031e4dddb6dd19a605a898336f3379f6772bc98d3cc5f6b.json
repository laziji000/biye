{"ast":null,"code":"import { getAllRoleList, addUser, editUser } from \"./api.js\";\nimport { validateUsername, validateMobile, validatePassword } from \"@/libs/validate\";\nimport departmentTreeChoose from \"@/views/template/department-tree-choose\";\nimport uploadPicInput from \"@/views/template/upload-pic-input\";\nimport SetPassword from \"@/views/template/set-password\";\nimport dict from \"@/views/template/dict\";\nexport default {\n  name: \"user\",\n  components: {\n    departmentTreeChoose,\n    uploadPicInput,\n    SetPassword,\n    dict\n  },\n  props: {\n    value: {\n      type: Boolean,\n      default: false\n    },\n    data: {\n      type: Object\n    },\n    type: {\n      type: String,\n      default: \"0\"\n    }\n  },\n  data() {\n    return {\n      visible: this.value,\n      title: \"\",\n      passColor: \"\",\n      submitLoading: false,\n      form: {\n        addressArray: []\n      },\n      formValidate: {\n        username: [{\n          required: true,\n          message: \"请输入登录账号\",\n          trigger: \"blur\"\n        }, {\n          validator: validateUsername,\n          trigger: \"blur\"\n        }],\n        nickname: [{\n          required: true,\n          message: \"请输入用户名\",\n          trigger: \"blur\"\n        }],\n        mobile: [{\n          required: true,\n          message: \"请输入手机号\",\n          trigger: \"blur\"\n        }, {\n          validator: validateMobile,\n          trigger: \"blur\"\n        }],\n        password: [{\n          required: true,\n          message: \"请输入密码\",\n          trigger: \"blur\"\n        }, {\n          validator: validatePassword,\n          trigger: \"blur\"\n        }],\n        email: [{\n          required: true,\n          message: \"请输入邮箱地址\"\n        }, {\n          type: \"email\",\n          message: \"邮箱格式不正确\"\n        }]\n      },\n      roleList: []\n    };\n  },\n  methods: {\n    init() {\n      this.getRoleList();\n    },\n    getRoleList() {\n      getAllRoleList().then(res => {\n        if (res.success) {\n          this.roleList = res.result;\n        }\n      });\n    },\n    handleSelectDepTree(v) {\n      this.form.departmentId = v;\n    },\n    changeAddress(v) {\n      this.form.address = JSON.stringify(this.form.addressArray);\n    },\n    changePass(v, grade, strength) {\n      this.form.passStrength = strength;\n    },\n    submit() {\n      this.$refs.form.validate(valid => {\n        if (valid) {\n          if (this.type == \"1\") {\n            this.submitLoading = true;\n            editUser(this.form).then(res => {\n              this.submitLoading = false;\n              if (res.success) {\n                this.$Message.success(\"操作成功\");\n                this.$emit(\"on-submit\", true);\n                this.visible = false;\n              }\n            });\n          } else {\n            this.submitLoading = true;\n            addUser(this.form).then(res => {\n              this.submitLoading = false;\n              if (res.success) {\n                this.$Message.success(\"操作成功\");\n                this.$emit(\"on-submit\", true);\n                this.visible = false;\n              }\n            });\n          }\n        }\n      });\n    },\n    setCurrentValue(value) {\n      if (value === this.visible) {\n        return;\n      }\n      if (this.type == \"1\") {\n        this.title = \"编辑\";\n      } else if (this.type == \"2\") {\n        this.title = \"添加\";\n      } else {\n        this.title = \"详情\";\n      }\n      this.$refs.form.resetFields();\n      if (this.type == \"0\" || this.type == \"1\") {\n        // 回显数据\n        let data = this.data;\n        // 地址\n        if (data.address) {\n          data.addressArray = JSON.parse(data.address);\n        } else {\n          data.addressArray = [];\n        }\n        // 部门\n        this.$refs.depTree.setData(data.departmentId, data.departmentTitle);\n        // 角色\n        let selectRolesId = [];\n        data.roles.forEach(function (e) {\n          selectRolesId.push(e.id);\n        });\n        data.roleIds = selectRolesId;\n        delete data.roles;\n        delete data.permissions;\n        // 密码强度\n        if (data.passStrength == \"弱\") {\n          this.passColor = \"#ed3f14\";\n        } else if (data.passStrength == \"中\") {\n          this.passColor = \"#faad14\";\n        } else if (data.passStrength == \"强\") {\n          this.passColor = \"#52c41a\";\n        }\n        // 回显\n        this.form = data;\n      } else {\n        // 添加\n        this.$refs.depTree.setData(\"\", \"\");\n        this.form = {\n          type: 0,\n          sex: \"\",\n          addressArray: []\n        };\n      }\n      this.visible = value;\n    }\n  },\n  watch: {\n    value(val) {\n      this.setCurrentValue(val);\n    },\n    visible(value) {\n      this.$emit(\"input\", value);\n    }\n  },\n  mounted() {\n    this.init();\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}