{"ast":null,"code":"import { getMyDoorList, setMyDoorList, userInfoEdit } from \"./api.js\";\nimport uploadPicThumb from \"@/views/template/upload-pic-thumb\";\nimport Cookies from \"js-cookie\";\nimport dict from \"@/views/template/dict\";\nimport search from \"./search.vue\";\nexport default {\n  components: {\n    uploadPicThumb,\n    dict,\n    search\n  },\n  name: \"my_home_index\",\n  data() {\n    return {\n      editFlag: false,\n      userForm: {\n        id: \"\",\n        avatar: \"\",\n        username: \"\",\n        sex: \"\",\n        status: \"\",\n        type: \"\",\n        typeTxt: \"\",\n        address: \"\",\n        addressArray: []\n      },\n      saveLoading: false,\n      addMenuTempList: []\n    };\n  },\n  methods: {\n    init() {\n      let v = JSON.parse(Cookies.get(\"userInfo\"));\n      for (let attr in v) {\n        if (v[attr] == null) {\n          v[attr] = \"\";\n        }\n      }\n      let str = JSON.stringify(v);\n      let userInfo = JSON.parse(str);\n      userInfo.addressArray = [];\n      this.userForm = userInfo;\n      if (userInfo.address) {\n        this.userForm.address = userInfo.address;\n        this.userForm.addressArray = JSON.parse(userInfo.address);\n      }\n      if (this.userForm.type == 0) {\n        this.userForm.typeTxt = \"普通用户\";\n      } else if (this.userForm.type == 1) {\n        this.userForm.typeTxt = \"管理员\";\n      }\n    },\n    addMenuTempFx(e) {\n      if (this.addMenuTempList.length > 5) {\n        this.$Message.warning(\"最多添加六个常用模块\");\n      } else {\n        this.addMenuTempList.push(e);\n      }\n    },\n    addMenuFx() {\n      var str = \"\";\n      var size = this.addMenuTempList.length;\n      if (size > 0) {\n        str += this.addMenuTempList[0].name;\n        for (var i = 1; i < size; i++) {\n          str += \"ZWZ666\" + this.addMenuTempList[i].name;\n        }\n      }\n      setMyDoorList({\n        str: str\n      }).then(res => {\n        if (res.success) {\n          this.$Message.warning(\"操作成功\");\n        }\n      });\n    },\n    saveEdit() {\n      this.saveLoading = true;\n      this.editFlag = false;\n      if (typeof this.userForm.birth == \"object\") {\n        this.userForm.birth = this.format(this.userForm.birth, \"yyyy-MM-dd\");\n      }\n      delete this.userForm.roles;\n      userInfoEdit(this.userForm).then(res => {\n        this.saveLoading = false;\n        if (res.success) {\n          this.$Message.success(\"保存成功\");\n          // 更新用户信息\n          Cookies.set(\"userInfo\", JSON.stringify(this.userForm));\n          // 更新头像\n          this.$store.commit(\"setAvatarPath\", this.userForm.avatar);\n        }\n      });\n    },\n    getMyDoorListFx() {\n      var that = this;\n      getMyDoorList().then(res => {\n        that.addMenuTempList = res.result;\n      });\n    },\n    deleteOneMenu(e) {\n      var array = [];\n      for (var i = 0; i < this.addMenuTempList.length; i++) {\n        if (this.addMenuTempList[i].name != e.name) {\n          array.push(this.addMenuTempList[i]);\n        }\n      }\n      this.addMenuTempList = array;\n    },\n    changeAddress() {\n      this.userForm.address = JSON.stringify(this.userForm.addressArray);\n    },\n    changeBirth(v) {\n      this.userForm.birth = v;\n    }\n  },\n  mounted() {\n    this.init();\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}